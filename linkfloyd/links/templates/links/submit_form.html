{% load i18n %}
<form action="#" method="post">
    {% csrf_token %}
    <div class="fieldWrapper" id="attachment_preview">
        {% with form.instance as link %}
            {% if link.url %}
               {% include "links/attachment.html" %}
            {% endif %}
        {% endwith %}
    </div>
    {% for field in form %}
        {% include "forms/form_field.html" %}
    {% endfor %}
    <input type="submit" value="{% trans "Submit" %}" />
</form>

<script type="application/javascript">
    $("#id_body").focus(function() {
        $(this).height(48)
    });
    var channels = [];
    var selected_channel;
    $("#id_channel option").each(function(index) {
        if ($(this).val()) {
            channels.push({
                id: $(this).val(),
                name: $(this).html()
            });
            if ($(this).attr("selected") === "selected") {
                selected_channel = index - 1;
            }
        }
    });
    var options = {
        tokenLimit: 1
    }
    if (selected_channel != undefined) {
        options.prePopulate = [channels[selected_channel]]
    }
    $("#id_channel").tokenInput(channels, options);
</script>
