{% extends "base.html" %}{% load i18n gravatar channel_tags qhonuskan_votes %}

{% block extra_head %}
    {% if highlight %}<script type="text/javascript" src="{{STATIC_URL}}js/libs/jquery.color.js"></script>{% endif %}
    <script type="text/javascript" src="{{STATIC_URL}}js/csrf_fix.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/links.js"></script>
    {% voting_script %}
{% endblock extra_head %}

{% block content %}
<div class="two-column">
    <div class="panel">
        {% if links_from == 'channel' %}
            {% with channel=instance %}
            <div class="about section">
                <h2 class="header">{% trans "About Channel" %}</h2>
                <p class="channel_description">{{channel.description|linebreaks}}</p>
            </div>
            <div class="actions section">
                <h2 class="header">{% trans "Actions" %}</h2>
                <div class="wrapper">
                    {% if user|is_following:channel %}
                    <form action="/channels/update_subscription/{{channel.slug}}/" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="unsubscribe">
                        <input type="submit" value="Unsubscibe">
                    </form>
                    {% else %}
                    <form action="/channels/update_subscription/{{channel.slug}}/" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="subscribe">
                        <input type="submit" value="Subscibe">
                    </form>
                    {% endif %}
                </div>
                <div class="wrapper">
                    {% if user|subscription_status:channel == 'admin' %}
                        <a class="buttonized" href="{% url update_channel channel.slug %}">Update Channel</a>
                    {% endif %}
                </div>
            </div>
            {% endwith %}
        {% endif %}
        {% if links_from == 'user' %}
            <div class="about section">
                <h2 class="header">{% trans "About User" %}</h2>
                <p class="channel_description">{{about_user}}</p>
            </div>
        {% endif %}
        {% if user.is_authenticated %}
            <div class="channels section">
                <h2 class="header">{% trans "Subscripted Channels" %}</h2>
                <ul class="channels">
                    {% for subscription in user.channel_subscriptions.all %}
                    <li>
                        <a href="{{subscription.channel.get_absolute_url}}">{{subscription.channel}}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        {% if links_from == 'channel' %}
            {% with channel=instance %}
            <div class="subscribers section">
                <h2 class="header">{% trans "Subscribers" %} ({{channel.subscription_set.all.count}})</h2>
                <div class="followers">
                    {% for subscription in channel.subscription_set.all %}
                    <a href="{{subscription.user.get_absolute_url}}" id="{{subscription.user.username}}">
                        <img src="{% gravatar_for_user subscription.user 30 %}" alt="{{subscription.user.username}}">
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endwith %}
       {% endif %}
    </div>
    <div class="content section">
        <h2 class="header">{{title}}
            <span class="ordering{% if ordering == 'top' %} active{% endif %}">
                <a href="?ordering=top">top voted</a>
            </span>
            <span class="ordering{% if ordering == 'controversial' %} active{% endif %}">
                <a href="?ordering=controversial">controversial</a>
            </span>
            <span class="ordering{% if ordering == 'latest' %} active{% endif %}">
                <a href="?ordering=latest">
                    Latest
                </a>
            </span>
        </h2>
        </ul>
        <div class="body">
            {% for link in links %}
                {% include "links/link_as_list_item.html" %}
            {% empty %}
                <p class="warning">{% trans "No links found." %}</p>
            {% endfor %}
            {% with page_obj=links %}
                {% include "pagination_links.html" %}
            {% endwith %}
        </div>
    </div>
</div>
<script type="text/javascript">
    var addthis_share = { 
        templates: {
            twitter: '{{title}} {{url}}'
        }
    }

    var addthis_config = {
        "ui_click": true,
        "ui_header_color": "#333",
        "ui_header_background": "#fff",
        "ui_use_css": true,
        "ui_use_addressbook": true,
        "data_ga_property": "UA-6315603-13",
        "data_ga_social": true,
        "services_expanded": "friendfeed,reddit,twitter"
    }
</script>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=miratcan"></script>
{% if highlight %}
    <script type="text/javascript">
        $("div.link#"+{{highlight}}).animate({
            backgroundColor: 'rgba(0, 0, 0, 0)'}, 6000);
    </script>
{% endif %}
{% endblock content %}
